<!DOCTYPE html>
<html lang="th">
    <head>
        <meta charset="UTF-8">
        <title>Drama Control Panel</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script src="/socket.io/socket.io.js"></script>
        <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #121212; color: white; padding: 10px; text-align: center; }
        .section { background: #1e1e1e; padding: 15px; border-radius: 15px; margin-bottom: 15px; border: 1px solid #333; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        
        button { padding: 15px 5px; border-radius: 8px; border: none; font-weight: bold; font-size: 14px; cursor: pointer; transition: 0.2s; }
        button:active { transform: scale(0.95); opacity: 0.8; }
        
        .btn-bgm { background: #03dac6; color: black; }
        .btn-sfx { background: #cf6679; color: white; }
        .btn-stop { background: #ffffff; color: #000; width: 100%; margin-top: 15px; font-size: 18px; padding: 20px; }

        .vol-container { padding: 10px; background: #2c2c2c; border-radius: 10px; margin-bottom: 10px; }
        input[type=range] { width: 100%; cursor: pointer; }
        
        h3 { color: #bb86fc; font-size: 18px; margin-top: 0; border-bottom: 1px solid #333; padding-bottom: 8px; margin-bottom: 15px; }
    </style>
    </head>
    <body>

        <div class="section">
            <h3>üéö Volume Control</h3>
            <div class="vol-container">
                <label>Master: <span id="vol-master-num">100</span>%</label>
                <input type="range" min="0" max="1" step="0.01" value="1"
                    oninput="updateVolume('master', this.value)">
            </div>
            <div class="grid">
                <div class="vol-container">
                    <label>BGM: <span id="vol-bgm-num">100</span>%</label>
                    <input type="range" min="0" max="1" step="0.01" value="1"
                        oninput="updateVolume('bgm', this.value)">
                </div>
                <div class="vol-container">
                    <label>SFX: <span id="vol-sfx-num">100</span>%</label>
                    <input type="range" min="0" max="1" step="0.01" value="1"
                        oninput="updateVolume('sfx', this.value)">
                </div>
            </div>

            <div class="grid" style="margin-top: 10px;">
                <button style="background: #ffb74d; color: black;"
                    onclick="sendCommand('pause-bgm')">‚è∏ PAUSE BGM
                    (‡∏û‡∏±‡∏Å‡πÄ‡∏û‡∏•‡∏á)</button>
                <button style="background: #81c784; color: black;"
                    onclick="sendCommand('resume-bgm')">‚ñ∂Ô∏è RESUME BGM
                    (‡πÄ‡∏•‡πà‡∏ô‡∏ï‡πà‡∏≠)</button>
            </div>
            <button class="btn-stop" onclick="sendCommand('stop-all')">‚èπ STOP
                ALL (‡∏´‡∏¢‡∏∏‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)</button>
        </div>

        <div class="section">
            <h3>üé≠ ‡πÄ‡∏û‡∏•‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö (BGM) / SFX</h3>
            <div class="grid">
                <button class="btn-bgm" onclick="sendSound('track1')">1.
                    ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ô‡∏Å</button>
                <button class="btn-bgm" onclick="sendSound('track2')">2.
                    ‡∏´‡∏°‡∏î‡∏™‡∏¥‡πâ‡∏ô</button>
                <button class="btn-bgm" onclick="sendSound('track3')">3.
                    ‡∏û‡∏≤‡∏ß‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏û‡∏±‡∏ö‡πÄ‡∏Å‡∏¥‡∏•</button>
                <button class="btn-bgm" onclick="sendSound('track4')">4.
                    ‡∏•‡∏π‡∏ã‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏ô</button>
                <button class="btn-bgm" onclick="sendSound('track5')">5.
                    ‡∏Å‡∏¥‡∏ô‡∏Ç‡πâ‡∏≤‡∏ß</button>
                <button class="btn-bgm" onclick="sendSound('track6_1')">6.1
                    ‡∏ä‡∏≤‡∏ä‡∏±‡∏Å</button>
                <button class="btn-bgm" onclick="sendSound('track6_2')">6.2
                    ‡∏ô‡∏≤‡∏á‡∏£‡πâ‡∏≤‡∏¢‡∏ï‡∏ö</button>
                <button class="btn-bgm" onclick="sendSound('track7')">7.
                    ‡∏´‡∏ô‡∏π‡∏≠‡∏≠‡∏Å</button>
                <button class="btn-bgm" onclick="sendSound('track8')">8.
                    ‡∏´‡∏ô‡∏π‡πÄ‡∏ï‡πâ‡∏ô</button>
                <button class="btn-bgm" onclick="sendSound('track9')">9.
                    ‡∏ã‡∏±‡∏Å‡∏ú‡πâ‡∏≤</button>
                <button class="btn-bgm" onclick="sendSound('track10')">10.
                    ‡∏£‡∏≤‡∏ä‡∏≤‡∏≠‡∏¥‡∏•‡∏ç‡∏µ‡∏ô</button>
                <button class="btn-bgm" onclick="sendSound('track11')">11.
                    ‡∏™‡πà‡∏á‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢</button>
                <button class="btn-bgm" onclick="sendSound('track12')">12.
                    ‡∏ó‡∏≥‡∏ä‡∏∏‡∏î</button>
                <button class="btn-bgm" onclick="sendSound('track13')">13.
                    ‡∏£‡∏ñ‡∏°‡∏≤‡∏£‡∏±‡∏ö</button>
                <button class="btn-bgm" onclick="sendSound('track14_1')">14.1
                    ‡∏£‡πâ‡∏≠‡∏á‡πÑ‡∏´‡πâ</button>
                <button class="btn-bgm" onclick="sendSound('track14_2')">14.2
                    ‡∏£‡∏ñ‡∏ã‡∏∑‡πâ‡∏≠‡πÅ‡∏Å‡∏á</button>
                <button class="btn-bgm" onclick="sendSound('track15')">15.
                    ‡πÉ‡∏ô‡∏ß‡∏±‡∏á</button>
                <button class="btn-bgm" onclick="sendSound('track16')">16.
                    ‡∏ô‡∏±‡∏Å‡πÄ‡∏•‡∏á</button>
                <button class="btn-bgm" onclick="sendSound('track17')">17.
                    ‡∏ö‡πâ‡∏≤‡∏ô‡∏ã‡∏¥‡∏ô</button>
                <button class="btn-bgm" onclick="sendSound('track18')">18.
                    ‡∏à‡∏ö</button>
            </div>
        </div>
        <div class="section">
            <h3>üé¨ ‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå (SFX)</h3>
            <div class="grid">
                <button class="btn-sfx" onclick="sendSound('sfx1')">1.
                    ‡∏ô‡πâ‡∏≥‡∏´‡∏Å</button>
                <button class="btn-sfx" onclick="sendSound('sfx2')">2.
                    ‡∏î‡∏∂‡∏á‡∏ú‡πâ‡∏≤‡∏°‡πà‡∏≤‡∏ô</button>
                <button class="btn-sfx" onclick="sendSound('sfx3')">3.
                    ‡∏£‡∏∞‡πÄ‡∏ö‡∏¥‡∏î</button>
                <button class="btn-sfx" onclick="sendSound('sfx4')">4.
                    ‡∏ã‡∏±‡∏Å‡∏ú‡πâ‡∏≤</button>
                <button class="btn-sfx" onclick="sendSound('sfx5')">5.
                    ‡πÄ‡∏Ñ‡∏≤‡∏∞‡∏õ‡∏£‡∏∞‡∏ï‡∏π</button>
                <button class="btn-sfx" onclick="sendSound('sfx6')">6.
                    ‡πÄ‡∏õ‡∏¥‡∏î‡∏õ‡∏£‡∏∞‡∏ï‡∏π</button>
                <button class="btn-sfx" onclick="sendSound('sfx7')">7.
                    ‡∏î‡∏µ‡πÉ‡∏à</button>
                <button class="btn-sfx" onclick="sendSound('sfx8')">8.
                    ‡∏â‡∏µ‡∏Å‡πÄ‡∏™‡∏∑‡πâ‡∏≠</button>
                <button class="btn-sfx" onclick="sendSound('sfx9')">9.
                    ‡πÇ‡∏Å‡∏£‡∏ò</button>
                <button class="btn-sfx" onclick="sendSound('sfx10')">10.
                    ‡πÅ‡∏õ‡∏•‡∏á‡∏£‡πà‡∏≤‡∏á</button>
            </div>
        </div>

        <div style="display:none">
            <audio id="track1" src="sounds/1.‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ô‡∏Å.mov"
                preload="auto"></audio>
            <audio id="track2" src="sounds/2.‡∏´‡∏°‡∏î‡∏™‡∏¥‡πâ‡∏ô.mov"
                preload="auto"></audio>
            <audio id="track3" src="sounds/3.‡∏û‡∏≤‡∏ß‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏û‡∏±‡∏ö‡πÄ‡∏Å‡∏¥‡∏•.mov"
                preload="auto"></audio>
            <audio id="track4" src="sounds/4.‡∏•‡∏π‡∏ã‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏ô.mov"
                preload="auto"></audio>
            <audio id="track5" src="sounds/5.‡∏Å‡∏¥‡∏ô‡∏Ç‡πâ‡∏≤‡∏ß.mov"
                preload="auto"></audio>
            <audio id="track6_1" src="sounds/6.1‡∏ä‡∏≤‡∏ä‡∏±‡∏Å.mov"
                preload="auto"></audio>
            <audio id="track6_2" src="sounds/6.2‡∏ô‡∏≤‡∏á‡∏£‡πâ‡∏≤‡∏¢‡∏ï‡∏ö‡∏≠‡∏≤‡∏°‡∏µ‡∏ô(‡∏´‡∏•‡∏±‡∏á‡∏ä‡∏≤‡∏ä‡∏±‡∏Å).mov"
                preload="auto"></audio>
            <audio id="track7" src="sounds/7.‡∏´‡∏ô‡∏π‡∏≠‡∏≠‡∏Å.mov" preload="auto"></audio>
            <audio id="track8" src="sounds/8.‡∏´‡∏ô‡∏π‡πÄ‡∏ï‡πâ‡∏ô.mov"
                preload="auto"></audio>
            <audio id="track9" src="sounds/9.‡∏ã‡∏±‡∏Å‡∏ú‡πâ‡∏≤.mov" preload="auto"></audio>
            <audio id="track10" src="sounds/10.‡∏£‡∏≤‡∏ä‡∏≤‡∏≠‡∏¥‡∏•‡∏ç‡∏µ‡∏ô.mov"
                preload="auto"></audio>
            <audio id="track11" src="sounds/11.‡∏™‡πà‡∏á‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢.mov"
                preload="auto"></audio>
            <audio id="track12" src="sounds/12.‡∏ó‡∏≥‡∏ä‡∏∏‡∏î.mov"
                preload="auto"></audio>
            <audio id="track13" src="sounds/13.‡∏£‡∏ñ‡∏°‡∏≤‡∏£‡∏±‡∏ö.mov"
                preload="auto"></audio>
            <audio id="track14_1" src="sounds/14.1‡∏£‡πâ‡∏≠‡∏á‡πÑ‡∏´‡πâ.mov"
                preload="auto"></audio>
            <audio id="track14_2" src="sounds/14.2‡∏£‡πâ‡∏≠‡∏á‡πÑ‡∏´‡πâ ‡∏£‡∏ñ‡∏ã‡∏∑‡πâ‡∏≠‡πÅ‡∏Å‡∏á.mov"
                preload="auto"></audio>
            <audio id="track15" src="sounds/15.‡πÉ‡∏ô‡∏ß‡∏±‡∏á.mov"
                preload="auto"></audio>
            <audio id="track16" src="sounds/16.‡∏ô‡∏±‡∏Å‡πÄ‡∏•‡∏á.mov"
                preload="auto"></audio>
            <audio id="track17" src="sounds/17.‡∏ö‡πâ‡∏≤‡∏ô‡∏ã‡∏¥‡∏ô.mov"
                preload="auto"></audio>
            <audio id="track18" src="sounds/18.‡∏à‡∏ö.mov" preload="auto"></audio>

            <audio id="sfx1" src="sounds/1.‡∏ô‡πâ‡∏≥‡∏´‡∏Å_.mov" preload="auto"></audio>
            <audio id="sfx2" src="sounds/2.‡∏î‡∏∂‡∏á‡∏ú‡πâ‡∏≤‡∏°‡πà‡∏≤‡∏ô__.mov"
                preload="auto"></audio>
            <audio id="sfx3" src="sounds/3.‡∏£‡∏∞‡πÄ‡∏ö‡∏¥‡∏î_.mov" preload="auto"></audio>
            <audio id="sfx4" src="sounds/4.‡∏ã‡∏±‡∏Å‡∏ú‡πâ‡∏≤_.mov" preload="auto"></audio>
            <audio id="sfx5" src="sounds/5.‡πÄ‡∏Ñ‡∏≤‡∏∞‡∏õ‡∏£‡∏∞‡∏ï‡∏π__.mov"
                preload="auto"></audio>
            <audio id="sfx6" src="sounds/6.‡πÄ‡∏õ‡∏¥‡∏î‡∏õ‡∏£‡∏∞‡∏ï‡∏π_.mov"
                preload="auto"></audio>
            <audio id="sfx7" src="sounds/7.‡∏î‡∏µ‡πÉ‡∏à_.mov" preload="auto"></audio>
            <audio id="sfx8" src="sounds/8.‡∏â‡∏µ‡∏Å‡πÄ‡∏™‡∏∑‡πâ‡∏≠_.mov"
                preload="auto"></audio>
            <audio id="sfx9" src="sounds/9.‡πÇ‡∏Å‡∏£‡∏ò_.mov" preload="auto"></audio>
            <audio id="sfx10" src="sounds/10.‡πÅ‡∏õ‡∏•‡∏á‡∏£‡πà‡∏≤‡∏á_.mov"
                preload="auto"></audio>
        </div>

        <script>
        const socket = io();
const allAudios = document.querySelectorAll('audio');
let currentBGMId = null;

// ‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÅ‡∏¢‡∏Å‡∏Å‡∏±‡∏ô
let volumes = {
    master: 1,
    bgm: 1,
    sfx: 1
};

const fadeIntervals = {};

function sendSound(id) { socket.emit('play-sound', id); }
function sendCommand(cmd) { socket.emit('control-cmd', cmd); }

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÅ‡∏¢‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó
function updateVolume(type, val) {
    volumes[type] = parseFloat(val);
    document.getElementById(`vol-${type}-num`).innerText = Math.round(val * 100);
    socket.emit('volume-set', { type, val });
}

socket.on('do-play', (nextId) => {
    const nextAudio = document.getElementById(nextId);
    if (!nextAudio) return;

    if (nextId.startsWith('track')) {
        // ‡∏Å‡∏£‡∏ì‡∏µ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏û‡∏•‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö (BGM) ‡πÉ‡∏´‡πâ‡∏ó‡∏≥ Crossfade
        if (currentBGMId && currentBGMId !== nextId) {
            fadeOutAndStop(currentBGMId);
        }
        fadeInAndPlay(nextId);
        currentBGMId = nextId;
    } else {
        // ‡∏Å‡∏£‡∏ì‡∏µ‡πÄ‡∏õ‡πá‡∏ô SFX ‡πÉ‡∏´‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ã‡πâ‡∏≠‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
        nextAudio.volume = volumes.master * volumes.sfx;
        nextAudio.currentTime = 0;
        nextAudio.play().catch(e => console.log("User interaction required"));
    }
});

function fadeOutAndStop(id) {
    const audio = document.getElementById(id);
    if (!audio) return;
    clearInterval(fadeIntervals[id]);
    fadeIntervals[id] = setInterval(() => {
        if (audio.volume > 0.05) {
            audio.volume -= 0.05;
        } else {
            audio.volume = 0;
            audio.pause();
            audio.currentTime = 0;
            clearInterval(fadeIntervals[id]);
        }
    }, 30);
}

function fadeInAndPlay(id) {
    const audio = document.getElementById(id);
    if (!audio) return;
    clearInterval(fadeIntervals[id]);
    audio.volume = 0;
    audio.play().catch(e => console.log("Interaction required"));
    
    fadeIntervals[id] = setInterval(() => {
        const targetVol = volumes.master * volumes.bgm;
        if (audio.volume < targetVol - 0.05) {
            audio.volume += 0.05;
        } else {
            audio.volume = targetVol;
            clearInterval(fadeIntervals[id]);
        }
    }, 30);
}

// ‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏à‡∏≤‡∏Å Server
socket.on('do-volume', (data) => {
    volumes[data.type] = parseFloat(data.val);
    const label = document.getElementById(`vol-${data.type}-num`);
    if (label) label.innerText = Math.round(data.val * 100);
    
    allAudios.forEach(a => {
        if (!a.paused) {
            if (a.id.startsWith('track')) {
                a.volume = volumes.master * volumes.bgm;
            } else {
                a.volume = volumes.master * volumes.sfx;
            }
        }
    });
});

// ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° (Stop / Pause / Resume)
socket.on('do-control', (cmd) => {
    if (cmd === 'stop-all') {
        allAudios.forEach(a => {
            clearInterval(fadeIntervals[a.id]);
            a.pause();
            a.currentTime = 0;
        });
        currentBGMId = null;
    } 
    else if (cmd === 'pause-bgm') {
        // ‡∏û‡∏±‡∏Å‡πÄ‡∏û‡∏•‡∏á BGM ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
        if (currentBGMId) {
            const audio = document.getElementById(currentBGMId);
            if (audio) audio.pause();
        }
    } 
    else if (cmd === 'resume-bgm') {
        // ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏û‡∏•‡∏á BGM ‡∏ï‡πà‡∏≠‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏≤‡∏á‡πÑ‡∏ß‡πâ
        if (currentBGMId) {
            const audio = document.getElementById(currentBGMId);
            if (audio) audio.play().catch(e => console.log("Interaction required"));
        }
    }
});
    </script>
    </body>
</html>